<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP</title>
</head>
<body>
<div id="app">
    <div v-if="!otpVerified">
        <h2>Enter OTP</h2>
        <form @submit.prevent="handleOtp">
            <input type="text" v-model="otp" placeholder="Enter OTP" required>
            <button type="submit">Verify OTP</button>
        </form>
        <p v-if="errorMessage" style="color:red;">{{ errorMessage }}</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            otp: '',
            errorMessage: '',
            otpVerified: false
        },
        created() {
            // Check if user already passed OTP verification
            const isOtpVerified = localStorage.getItem('is_otp') === 'true';
            if (isOtpVerified) {
                window.location.href = 'dashboard.html';
            }
        },
        methods: {
            async handleOtp() {
                try {
                    const response = await fetch('actOtp.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ otp: this.otp })
                    });
                    const data = await response.json();

                    if (data.success) {
                        // Set is_otp = true in localStorage
                        localStorage.setItem('is_otp', 'true');
                        // Redirect ke dashboard
                        window.location.href = 'dashboard.html';
                    } else {
                        this.errorMessage = 'Invalid OTP';
                    }
                } catch (error) {
                    this.errorMessage = 'OTP verification failed. Please try again later.';
                }
            }
        }
    });
</script>
</body>
</html>
