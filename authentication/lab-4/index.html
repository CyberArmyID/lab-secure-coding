<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
</head>
<body>
<div id="app">
    <div v-if="!loggedIn">
        <h2>Login</h2>
        <form @submit.prevent="handleLogin">
            <input type="text" v-model="username" placeholder="Username" required>
            <input type="password" v-model="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
        <p v-if="errorMessage" style="color:red;">{{ errorMessage }}</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            username: '',
            password: '',
            errorMessage: '',
            loggedIn: false
        },
        created() {
            // Check if already logged in and OTP verified
            const isOtpVerified = localStorage.getItem('is_otp') === 'true';
            if (isOtpVerified) {
                window.location.href = 'dashboard.html';
            }
        },
        methods: {
            async handleLogin() {
                try {
                    const response = await fetch('actLogin.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            username: this.username,
                            password: this.password
                        })
                    });
                    const data = await response.json();

                    if (data.success) {
                        // Simpan is_otp = false di localStorage
                        localStorage.setItem('is_otp', 'false');
                        // Redirect ke halaman OTP
                        window.location.href = 'otp.html';
                    } else {
                        this.errorMessage = 'Invalid login credentials';
                    }
                } catch (error) {
                    this.errorMessage = 'Login failed. Please try again later.';
                }
            }
        }
    });
</script>
</body>
</html>
